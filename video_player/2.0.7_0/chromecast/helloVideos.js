function openCastWindow(n){var t=null;onInstallCast=function(){window.open("https://chrome.google.com/webstore/detail/google-cast/boadgeojelhgndaghljhdicfkmllpafd");sendEventStatistic("Chromecast","Install extension")};onNoChromecast=function(){t&&window.wizardDialog.closeDialog(t);n&&n();sendEventStatistic("Chromecast","Don't have")};onLaunched=function(){var n,i;t&&window.wizardDialog.closeDialog(t);n=document.getElementById("extension-help");n.style.visibility="visible";n.style.top="7px";i=document.getElementById("caption-wrapper");i&&(i.style.visibility="hidden");setTimeout(function(){n.style.top="-80px";setTimeout(function(){n.style.visibility="hidden";i&&(i.style.visibility="visible")},4e3)},5e3)};onError=function(){console.log("cast api init failure");showInstallExtensionDialog()};onRestartClick=function(){saveLastState(function(){chrome.runtime.sendMessage({message:"switch_tab"},function(n){n.farewell=="close"&&window.close()})})};showInstallExtensionDialog=function(){var i,o,f,r,e,n,u;t=document.createElement("div");t.id="install-extension";t.className="bbm-modal bbm-modal--cast";window.wizardDialog.openDialog(t,.7)&&(i=document.createElement("div"),i.className="bbm-views bbm-views-cast",t.appendChild(i),o=document.createElement("div"),o.className="cast-image",i.appendChild(o),n=document.createElement("h"),n.textContent=chrome.i18n.getMessage("installCastExtensionTitle"),i.appendChild(n),n=document.createElement("h2"),n.textContent=chrome.i18n.getMessage("installCastExtensionDescription1"),i.appendChild(n),r=document.createElement("div"),r.className="install-cast-wrapper",i.appendChild(r),f=document.createElement("button"),f.textContent=chrome.i18n.getMessage("installCastExtensionInstall"),f.onclick=onInstallCast,r.appendChild(f),r=document.createElement("div"),r.className="buttons-wrapper-cast",i.appendChild(r),e=document.createElement("button"),e.textContent=chrome.i18n.getMessage("installCastExtensionNoChromecast"),e.onclick=onNoChromecast,r.appendChild(e),n=document.createElement("h2"),n.textContent=chrome.i18n.getMessage("installCastExtensionDescription2")+" ",i.appendChild(n),u=document.createElement("a"),u.className="h2-link",u.style.cursor="none",u.target="blank",u.textContent=chrome.i18n.getMessage("hereLink"),u.onclick=onRestartClick,n.appendChild(u),f.focus())};launchCastWindow(onLaunched,onError)}function launchCastWindow(n,t){function e(){try{var n=new chrome.cast.SessionRequest(chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID),i=new chrome.cast.ApiConfig(n,s,h,chrome.cast.AutoJoinPolicy.PAGE_SCOPED,chrome.cast.DefaultActionPolicy.CAST_THIS_TAB);chrome.cast.initialize(i,o,t)}catch(r){t()}}function o(){console.log("init success")}function s(n){r=n;f()}function h(n){n==="available"?console.log("receiver found"):console.log("receiver list empty");i();i();i()}function i(){console.log("launching app...");chrome.cast.requestSession(c,l)}function c(n){console.log("session success: "+n.sessionId);r=n;f()}function l(){!u&&n&&n();u=!0}function f(){console.log("stopping");r.stop(a,onError)}function a(){console.log("app stopped")}var r=null,u=!1;chrome.cast&&chrome.cast.isAvailable?(i(),i(),i()):setTimeout(e,1e3)}activateChromecastBeta=function(){!betaActivated||betaExtended||chromecastMode?betaActivated&&!chromecastMode?showChromecastBetaFinishedDialog():showActivateChromecastBetaDialog():showChromecastBetaProlongationDialog()};showActivateChromecastBetaDialog=function(){var n,r,u,i,f,t;modalElement=document.createElement("div");modalElement.id="activate-chromecast";modalElement.className="bbm-modal bbm-modal--beta";onActivate=function(){var i,t,n;modalElement&&(i=document.createElement("div"),i.className="spinner-center spinner",modalElement.appendChild(i));t=new Date;n=new Date;n.setMonth(t.getMonth()+3);chrome.storage.sync.set({betaProgramActivationDate:t.getTime(),betaProgramExpirationDate:n.getTime()},function(){console.log("betaProgramActivationDate ",t," betaProgramExpirationDate ",n);betaActivated=!0;chromecastMode=!0;a=1;window.gCastMode="desktop";updateCastButton();saveLastState(function(){var t=document.getElementById("notice-chromecast-callout"),i,r,u;t&&(t.style.display="block",setTimeout(function(){t.style.opacity=0},1e4));gAnalyticsConfig&&(i=gAnalyticsConfig.isTrackingPermitted(),i||gAnalyticsConfig.setTrackingPermitted(!0),r=n.getFullYear().toString(),u=(n.getMonth()+1).toString(),sendEventStatistic("Cast Beta","Activated until",r+"-"+u),i||gAnalyticsConfig.setTrackingPermitted(!1));setTimeout(function(){t&&(t.style.opacity=1);modalElement&&window.wizardDialog.closeDialog(modalElement)},1e3)})})};onCancel=function(){modalElement&&window.wizardDialog.closeDialog(modalElement);sendEventStatistic("Cast Beta","Declined")};window.wizardDialog.openDialog(modalElement,.7)&&(n=document.createElement("div"),n.className="bbm-views bbm-views-cast",modalElement.appendChild(n),r=document.createElement("div"),r.className="cast-image cast-image-beta1",n.appendChild(r),r=document.createElement("div"),r.className="cast-image cast-image-beta2",n.appendChild(r),t=document.createElement("h"),t.textContent=chrome.i18n.getMessage("activateChromecastBeta"),n.appendChild(t),t=document.createElement("h2"),t.textContent=chrome.i18n.getMessage("activateChromecastBetaDescription")+" "+chrome.i18n.getMessage("activateChromecastBetaOffer"),n.appendChild(t),i=document.createElement("div"),i.className="install-cast-wrapper",n.appendChild(i),u=document.createElement("button"),u.textContent=chrome.i18n.getMessage("activateChromecastBetaButtonActivate"),u.onclick=onActivate,i.appendChild(u),i=document.createElement("div"),i.className="buttons-wrapper-cast",n.appendChild(i),f=document.createElement("button"),f.textContent=chrome.i18n.getMessage("activateChromecastBetaButtonCancel"),f.onclick=onCancel,i.appendChild(f),t=document.createElement("div"),t.className="help-description",t.textContent=chrome.i18n.getMessage("activateChromecastBetaSupport"),n.appendChild(t),u.focus())};showChromecastBetaProlongationDialog=function(){var t,r,i,u,n,f,e,o;modalElement=document.createElement("div");modalElement.id="beta-finished";modalElement.className="bbm-modal bbm-modal--beta";onActivate=function(){var i,t,n;modalElement&&(i=document.createElement("div"),i.className="spinner-center spinner",modalElement.appendChild(i));t=new Date;n=new Date;n.setMonth(t.getMonth()+3);chrome.storage.sync.set({betaProgramProlongationDate:t.getTime(),betaProgramExpirationDate:n.getTime()},function(){console.log("betaProgramProlongationDate ",t," betaProgramExpirationDate ",n);betaActivated=!0;betaExtended=!0;chromecastMode=!0;a=1;window.gCastMode="desktop";updateCastButton();saveLastState(function(){var t,i,r;gAnalyticsConfig&&(t=gAnalyticsConfig.isTrackingPermitted(),t||gAnalyticsConfig.setTrackingPermitted(!0),i=n.getFullYear().toString(),r=(n.getMonth()+1).toString(),sendEventStatistic("Cast Beta","Reactivated until",i+"-"+r),t||gAnalyticsConfig.setTrackingPermitted(!1));setTimeout(function(){modalElement&&window.wizardDialog.closeDialog(modalElement)},1e3)})})};onCancel=function(){modalElement&&window.wizardDialog.closeDialog(modalElement);sendEventStatistic("Cast Beta","Declined")};window.wizardDialog.openDialog(modalElement,.7)&&(t=document.createElement("div"),t.className="bbm-views bbm-views-cast",modalElement.appendChild(t),n=document.createElement("h"),n.textContent=chrome.i18n.getMessage("betaProlongation"),t.appendChild(n),n=document.createElement("h2"),n.textContent=chrome.i18n.getMessage("betaProlongationDescription"),t.appendChild(n),i=document.createElement("div"),i.className="install-cast-wrapper",t.appendChild(i),r=document.createElement("button"),r.textContent=chrome.i18n.getMessage("activateChromecastBetaButtonActivate"),r.onclick=onActivate,i.appendChild(r),i=document.createElement("div"),i.className="buttons-wrapper-cast",t.appendChild(i),u=document.createElement("button"),u.textContent=chrome.i18n.getMessage("activateChromecastBetaButtonCancel"),u.onclick=onCancel,i.appendChild(u),n=document.createElement("div"),n.className="help-description",f=isCastMode()?"cursor:none":"",n.innerHTML=chrome.i18n.getMessage("betaProlongationFeedback")+' <a href="https://chrome.google.com/webstore/detail/video-player/gdebnehfojpoccpaocfbelbclfnpbmij/reviews" style="'+f+'" target="_blank">'+chrome.i18n.getMessage("hereLink")+"<\/a>",t.appendChild(n),r.focus());e=(new Date).getFullYear().toString();o=((new Date).getMonth()+1).toString();sendEventStatistic("Cast Beta","Prolonged on",e+"-"+o)};showChromecastBetaFinishedDialog=function(){var n,t,r,i,u,f;modalElement=document.createElement("div");modalElement.id="beta-finished";modalElement.className="bbm-modal bbm-modal--beta";onOk=function(){modalElement&&window.wizardDialog.closeDialog(modalElement)};window.wizardDialog.openDialog(modalElement,.7)&&(n=document.createElement("div"),n.className="bbm-views bbm-views-cast",modalElement.appendChild(n),t=document.createElement("h"),t.textContent=chrome.i18n.getMessage("betaFinished"),n.appendChild(t),t=document.createElement("h2"),t.textContent=chrome.i18n.getMessage("betaFinishedDescription"),n.appendChild(t),r=document.createElement("div"),r.className="buttons-wrapper-cast",n.appendChild(r),i=document.createElement("button"),i.textContent="OK",i.onclick=onOk,r.appendChild(i),i.focus());u=(new Date).getFullYear().toString();f=((new Date).getMonth()+1).toString();sendEventStatistic("Cast Beta","Expired on",u+"-"+f)}